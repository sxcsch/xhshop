
!function(a,b,c){function d(c){c=c||{};var d=a.extend({},q,c.layer||{});d.end=function(){g.stop(),g.destroy()};var f=layer.open(d),g=b.create(c.uploader||{});return g.layer=a("#layui-layer"+f),e(g),g}function e(a){var b=a.layer;a.addButton(b.find(".selectFile")),a.$content=b.find(".uploader .content"),b.find(".startAll").on("click",function(){a.upload()}),b.find(".cancelAll").on("click",function(){a.stop()}),a.on("fileQueued",f),a.on("fileDequeued",g),a.on("startUpload",h),a.on("stopUpload",i),a.on("uploadFinished",j),a.on("uploadStart",k),a.on("uploadProgress",l),a.on("uploadError",n),a.on("uploadSuccess",o),a._$progressWrap=b.find(".prog").hide(),a._$progressBar=b.find(".prog .prog-bar"),a._$progressText=b.find(".prog span"),a._$msg=b.find(".msg").hide(),a.fileSize=0,a.fileCount=0,a._percentages={}}function f(c){var d=c._dom=a('<div layout="row">\n    <span class="fileName" flex></span>\n    <span class="fileSize"></span>\n    <span class="fileProg">0%</span>\n    <span class="fileState"><i class="fi fi-state-normal"></i></span>\n</div>');this.$content.append(d),d.find(".fileName").text(c.name),d.find(".fileSize").text(b.formatSize(c.size)),c._$icon=d.find(".fileState i").removeClass().addClass("glyphicon glyphicon-minus-sign"),c._$dom=d,c._$progress=d.find(".fileProg"),d.data("file",c),this.fileSize+=c.size,this.fileCount++,this._percentages[c.id]=[c.size,0]}function g(a){a._$dom.remove(),this.fileSize-=a.size,this.fileCount--,delete this._percentages[a.id],m.call(this)}function h(){this._$progressWrap.show(),this._$msg.hide()}function i(){this._$progressWrap.hide()}function j(){this._$progressWrap.hide();var a=this.getStats();this._$msg.show().text("成功上传"+a.successNum+"个文件，"+a.uploadFailNum+"个文件上传失败")}function k(a){a._$icon.removeClass().addClass("fi fi-upload"),a._$dom.addClass("upload")}function l(a,b){a._$progress.text(Math.round(100*b)+"%"),this._percentages[a.id][1]=b,m.call(this)}function m(){var b,c=0,d=0;a.each(this._percentages,function(a,b){d+=b[0],c+=b[0]*b[1]}),b=d?c/d:0,this._$progressBar.width(Math.round(100*b)+"%")}function n(a,b){a._$icon.removeClass().addClass("fi fi-state-exclamationb"),a._$progress.text(b),a._$dom.addClass("error")}function o(a){a._$icon.removeClass().addClass("fi fi-state-normal"),a._$dom.addClass("success")}var p=!a&&!b||!c;if(a.uploader=function(b,c){if(p)return console.error("Uploader 需要加载插件[jQuery , WebUploader , Layer]"),!1;a.isFunction(b)&&!c&&(c=b,b=null);var e=d(b);return e.on("uploadFinished",function(){a.isFunction(c)&&c(e)}),e},!p)var q={id:"layer-uploader",type:1,title:0,closeBtn:2,skin:"uploader-box",move:".header",area:["500px","300px"],width:500,height:400,content:'<div class="uploader" layout-fill layout="column">\n    <div layout="row" class="header">\n        <span class="fileName" flex>文件名称</span>\n        <span class="fileSize">大小</span>\n        <span class="fileProg"></span>\n        <span class="fileState">状态</span>\n    </div>\n    <div flex class="content">\n    </div>\n    <div class="footer" layout="row" layout-align="start center">\n        <span class="selectFile">添加</span>\n        <button class="btn btn-default btn-sm startAll">上传</button>\n        <button class="btn btn-default btn-sm cancelAll">停止上传</button>\n        <span flex></span>\n        <div class="prog" layout="row" layout-align="start center">\n            <div class="prog-wrap">\n                <div class="prog-bar"></div>\n            </div>\n            <span>正在上传</span>\n        </div>\n        <div class="msg"></div>\n    </div>\n</div>'}}(jQuery,window.WebUploader,window.layer);